generator client {
  provider = "prisma-client-js"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
}

// ============ ENUMS ============

enum Role {
  ADMIN
  CALEG
  KOORDINATOR
  RELAWAN
}

enum StatusDukungan {
  MENDUKUNG
  RAGU
  TIDAK_MENDUKUNG
  BELUM_DIKONFIRMASI
}

enum StatusPenerimaan {
  BELUM_DITERIMA
  SUDAH_DITERIMA
  DITOLAK
}

enum TipePertanyaan {
  TEXT
  PILIHAN_GANDA
  SKALA
  YA_TIDAK
}

enum StatusApproval {
  PENDING
  APPROVED
  REJECTED
}

enum ResponStatus {
  approve
  reject
}

enum KategoriIsu {
  HOAX
  ISU_NEGATIF
  BLACK_CAMPAIGN
  LAINNYA
}

enum TipeDistribusiLogistik {
  ADMIN_KE_KOORDINATOR
  KOORDINATOR_KE_RELAWAN
  RELAWAN_KE_PENDUKUNG
}


// ============ MODELS ============

model User {
  id            String    @id @default(cuid())
  username      String    @unique
  password      String
  namaLengkap   String
  email         String?   @unique
  nomorHp       String?
  role          Role      @default(RELAWAN)
  aktif         Boolean   @default(true)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  koordinator   Koordinator?
  relawan       Relawan?

  @@map("users")
}

model Wilayah {
  id           String   @id @default(cuid())
  namaWilayah  String
  provinsi     String
  kabupaten    String
  kecamatan    String
  kelurahan    String
  kodePos      String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  koordinators Koordinator[]
  relawans     Relawan[]
  pendukung    Pendukung[]
  waBlasts     WaBlast[]
  quickCountTps QuickCountTps[]

  @@unique([provinsi, kabupaten, kecamatan, kelurahan])
  @@map("wilayah")
}

model Koordinator {
  id          String   @id @default(cuid())
  userId      String   @unique
  wilayahId   String
  namaLengkap String
  noHp        String
  latitude    Float?
  longitude   Float?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  wilayah     Wilayah  @relation(fields: [wilayahId], references: [id])
  relawans    Relawan[]
  logistikDistribusi LogistikDistribusi[]

  @@map("koordinator")
}

model Relawan {
  id            String   @id @default(cuid())
  userId        String   @unique
  koordinatorId String
  wilayahId     String
  namaLengkap   String
  noHp          String
  latitude      Float?
  longitude     Float?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  user          User        @relation(fields: [userId], references: [id], onDelete: Cascade)
  koordinator   Koordinator @relation(fields: [koordinatorId], references: [id])
  wilayah       Wilayah     @relation(fields: [wilayahId], references: [id])
  pendukung     Pendukung[]
  distribusi    DistribusiSembako[]
  logistikDistribusi LogistikDistribusi[]

  @@map("relawan")
}

model Pendukung {
  id              String          @id @default(cuid())
  relawanId       String
  wilayahId       String
  namaLengkap     String
  nik             String          @unique
  noHp            String?
  alamat          String
  rt              String?
  rw              String?
  tps             String?
  latitude        Float?
  longitude       Float?
  fotoRumah       String?
  statusDukungan  StatusDukungan  @default(BELUM_DIKONFIRMASI)
  statusApproval  StatusApproval  @default(PENDING)
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt

  relawan         Relawan         @relation(fields: [relawanId], references: [id])
  wilayah         Wilayah         @relation(fields: [wilayahId], references: [id])
  jawabanSurvey   JawabanSurvey[]
  distribusi      DistribusiSembako[]
  logistikDistribusi LogistikDistribusi[]

  @@map("pendukung")
}

model Survey {
  id          String   @id @default(cuid())
  judul       String
  deskripsi   String?
  aktif       Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  pertanyaans PertanyaanSurvey[]

  @@map("survey")
}

model PertanyaanSurvey {
  id          String          @id @default(cuid())
  surveyId    String
  pertanyaan  String
  tipe        TipePertanyaan  @default(TEXT)
  opsi        String[]        // Array of options for multiple choice
  urutan      Int             @default(0)
  createdAt   DateTime        @default(now())

  survey      Survey          @relation(fields: [surveyId], references: [id], onDelete: Cascade)
  jawabans    JawabanSurvey[]

  @@map("pertanyaan_survey")
}

model JawabanSurvey {
  id                  String   @id @default(cuid())
  pertanyaanSurveyId  String
  pendukungId         String
  jawaban             String
  createdAt           DateTime @default(now())

  pertanyaanSurvey    PertanyaanSurvey @relation(fields: [pertanyaanSurveyId], references: [id], onDelete: Cascade)
  pendukung           Pendukung        @relation(fields: [pendukungId], references: [id], onDelete: Cascade)

  @@unique([pertanyaanSurveyId, pendukungId])
  @@map("jawaban_survey")
}

model DistribusiSembako {
  id                String          @id @default(cuid())
  pendukungId       String
  relawanId         String
  jenisBantuan      String
  tanggalDistribusi DateTime
  statusPenerimaan  StatusPenerimaan @default(BELUM_DITERIMA)
  keterangan        String?
  fotoBukti         String?
  createdAt         DateTime        @default(now())
  updatedAt         DateTime        @updatedAt

  pendukung         Pendukung       @relation(fields: [pendukungId], references: [id])
  relawan           Relawan         @relation(fields: [relawanId], references: [id])

  @@map("distribusi_sembako")
}

model WaBlast {
  id          String    @id @default(cuid())
  pesan       String
  mediaUrl    String?
  mediaType   String?   // text, image, pdf
  wilayahId   String?   // null = broadcast all
  status      String    @default("pending") // pending, sent, failed
  createdAt   DateTime  @default(now())

  wilayah     Wilayah?  @relation(fields: [wilayahId], references: [id])

  @@map("wa_blast")
}

model AgendaKegiatan {
  id           BigInt   @id @default(autoincrement())
  judul        String
  deskripsi    String?
  lokasi       String?
  tanggal      DateTime
  waktuMulai   DateTime
  waktuSelesai DateTime
  statusAktif  Boolean  @default(true)

  dibuatOleh   BigInt?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  respon       AgendaRespon[]

  @@map("agenda_kegiatan")
}

model AgendaRespon {
  id           BigInt   @id @default(autoincrement())
  agendaId     BigInt
  calegId      BigInt
  status       ResponStatus?
  waktuRespon  DateTime?

  agenda       AgendaKegiatan @relation(fields: [agendaId], references: [id])

  @@unique([agendaId, calegId])
  @@map("agenda_respon")
}
model Isu {
  id          String      @id @default(cuid())
  judul       String
  deskripsi   String
  kategori    KategoriIsu @default(LAINNYA)
  sumber      String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt

  buktiIsu    BuktiIsu[]

  @@map("isu")
}

model BuktiIsu {
  id          String   @id @default(cuid())
  isuId       String
  url         String
  keterangan  String?
  createdAt   DateTime @default(now())

  isu         Isu      @relation(fields: [isuId], references: [id], onDelete: Cascade)

  @@map("bukti_isu")
}

// ============ LOGISTIK ============

model LogistikItem {
  id          String   @id @default(cuid())
  namaBarang  String
  satuan      String   // kg, pcs, pak, dll
  deskripsi   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  logistikMasuk      LogistikMasuk[]
  logistikDistribusi LogistikDistribusi[]

  @@map("logistik_item")
}

model LogistikMasuk {
  id             String       @id @default(cuid())
  logistikItemId String
  jumlah         Int
  tanggal        DateTime
  keterangan     String?
  createdAt      DateTime     @default(now())

  logistikItem   LogistikItem @relation(fields: [logistikItemId], references: [id], onDelete: Cascade)

  @@map("logistik_masuk")
}

model LogistikDistribusi {
  id               String                  @id @default(cuid())
  logistikItemId   String
  jumlah           Int
  tanggal          DateTime
  tipeDistribusi   TipeDistribusiLogistik
  koordinatorId    String?
  relawanId        String?
  pendukungId      String?
  keterangan       String?
  createdAt        DateTime                @default(now())

  logistikItem     LogistikItem  @relation(fields: [logistikItemId], references: [id], onDelete: Cascade)
  koordinator      Koordinator?  @relation(fields: [koordinatorId], references: [id])
  relawan          Relawan?      @relation(fields: [relawanId], references: [id])
  pendukung        Pendukung?    @relation(fields: [pendukungId], references: [id])

  @@map("logistik_distribusi")
}

// ============ QUICK COUNT ============

model QuickCountTps {
  id          String   @id @default(cuid())
  nomorTps    String
  wilayahId   String
  alamat      String?
  jumlahDpt   Int      @default(0) // Daftar Pemilih Tetap
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  wilayah     Wilayah  @relation(fields: [wilayahId], references: [id])
  hasilCounts QuickCountHasil[]

  @@unique([nomorTps, wilayahId])
  @@map("quick_count_tps")
}

model QuickCountCalon {
  id           String   @id @default(cuid())
  nomorUrut    Int
  namaCalon    String
  partai       String?
  foto         String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  hasilCounts  QuickCountHasil[]

  @@unique([nomorUrut])
  @@map("quick_count_calon")
}

model QuickCountHasil {
  id          String   @id @default(cuid())
  tpsId       String
  calonId     String
  jumlahSuara Int      @default(0)
  fotoBukti   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  tps         QuickCountTps   @relation(fields: [tpsId], references: [id], onDelete: Cascade)
  calon       QuickCountCalon @relation(fields: [calonId], references: [id], onDelete: Cascade)

  @@unique([tpsId, calonId])
  @@map("quick_count_hasil")
}
